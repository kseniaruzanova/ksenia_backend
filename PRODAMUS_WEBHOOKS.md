# Prodamus Webhooks - Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°

## ÐžÐ±Ð·Ð¾Ñ€

Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ñ‹Ðµ webhook'Ð¸ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ñ‡ÐµÑ€ÐµÐ· Prodamus Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð² Ð‘Ð” Ð¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.

## ðŸŽ¯ Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Webhook (Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)

### Endpoint: `/api/prodamus/webhook`
**ÐœÐµÑ‚Ð¾Ð´:** POST

Ð•Ð´Ð¸Ð½Ñ‹Ð¹ ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ endpoint Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ **Ð²ÑÐµÑ… Ñ‚Ð¸Ð¿Ð¾Ð² Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹** Ð¾Ñ‚ Prodamus. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ñ‚Ð¸Ð¿ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° (Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ° Ð¸Ð»Ð¸ Ñ€Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð¿Ð»Ð°Ñ‚ÐµÐ¶) Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼.

#### ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:
âœ… **ÐžÐ´Ð¸Ð½ endpoint Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹** - ÑƒÐ¿Ñ€Ð¾Ñ‰Ð°ÐµÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ Ð² Prodamus  
âœ… **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð°** - Ð¿Ð¾ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…  
âœ… **Ð•Ð´Ð¸Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº** - ÐºÐ¾Ð½ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ  
âœ… **Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** - Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÑ‚Ð°Ð¿Ð°

#### ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:

1. **ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚ Prodamus**
2. **ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ñ‚Ð¸Ð¿ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°:**
   - Ð•ÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð¾Ð»Ðµ `subscription[id]` â†’ **ÐŸÐ¾Ð´Ð¿Ð¸ÑÐºÐ°**
   - Ð•ÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð¾Ð»Ñ `_param_user` Ð¸ `_param_customer_id` â†’ **Ð Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ Ð·Ð° Ñ€Ð°ÑÐºÐ»Ð°Ð´**
3. **Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸**

#### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Prodamus:
```
Webhook URL: https://your-domain.com/api/prodamus/webhook
```

---

## Webhooks (Ð£ÑÑ‚Ð°Ñ€ÐµÐ²ÑˆÐ¸Ðµ, Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð´Ð»Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸)

### 1. Webhook Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº

**Endpoint:** `/api/prodamus/webhook/subscription` *(deprecated)*  
**ÐœÐµÑ‚Ð¾Ð´:** POST

#### Ð§Ñ‚Ð¾ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚:
- ÐžÐ¿Ð»Ð°Ñ‚Ñƒ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº Basic Ð¸ Pro
- ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸ÑŽ/Ð´ÐµÐ°ÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸ÑŽ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
- ÐŸÑ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº

#### ÐÐ¾Ð²Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸:
âœ… **Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² Ð‘Ð”** - Ð²ÑÐµ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸ `Payments`
âœ… **Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð² Telegram** - Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ð¸
âœ… **Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** - Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑÑ‚Ð°Ð¿Ðµ
âœ… **ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº** - graceful handling Ñ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸ÐµÐ¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

#### Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾Ñ‚ Prodamus:
```json
{
  "customer_extra": "customerId",
  "payment_status": "success",
  "order_num": "12345",
  "sum": "990",
  "subscription[id]": "2473695",
  "subscription[active_user]": "1",
  "subscription[date_next_payment]": "2025-11-04 12:00:00"
}
```

#### Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ:
```
ðŸŽ‰ ÐŸÐ¾Ð´Ð¿Ð¸ÑÐºÐ° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð°!

âœ… Ð¢Ð°Ñ€Ð¸Ñ„: PRO ðŸŒŸ
ðŸ“… Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð¾: 04.11.2025

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ñƒ Ñ‚ÐµÐ±Ñ ÐµÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ ÐºÐ¾ Ð²ÑÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼ Ð±Ð¾Ñ‚Ð°:
â€¢ Ð‘ÐµÐ·Ð»Ð¸Ð¼Ð¸Ñ‚Ð½Ñ‹Ðµ Ñ€Ð°ÑÐºÐ»Ð°Ð´Ñ‹ Ð¢Ð°Ñ€Ð¾ ðŸ”®
â€¢ Ð’ÑÐµ Ð°ÑÑ‚Ñ€Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð³Ð¾Ñ€Ð¾ÑÐºÐ¾Ð¿Ñ‹ ðŸŒŸ
â€¢ ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ð½Ð°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° ðŸ’¬

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ /menu Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° ÐºÐ¾ Ð²ÑÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼!
```

#### Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:
```javascript
{
  amount: 990,
  bot_name: "customer_username",
  username: "customer_username",
  type: "subscription_pro", // Ð¸Ð»Ð¸ "subscription_basic"
  createdAt: Date
}
```

---

### 2. Webhook Ñ€Ð°Ð·Ð¾Ð²Ñ‹Ñ… Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ (`handleTarotPaymentWebhook`)

**Endpoint:** `/api/prodamus/webhook/tarot-payment`  
**ÐœÐµÑ‚Ð¾Ð´:** POST

#### Ð§Ñ‚Ð¾ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚:
- Ð Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð¸ Ð·Ð° Ñ€Ð°ÑÐºÐ»Ð°Ð´Ñ‹ Ð¢Ð°Ñ€Ð¾ (100â‚½)
- Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ AI Ñ€Ð°ÑÐºÐ»Ð°Ð´Ð°

#### ÐÐ¾Ð²Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸:
âœ… **Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² Ð‘Ð”** - Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ñ Ñ‚Ð¸Ð¿Ð¾Ð¼ `tarot_reading`
âœ… **ÐœÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ** - ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð´Ð°Ñ‚Ð° Ð¸ ÑÑƒÐ¼Ð¼Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°
âœ… **Ð£Ð¼Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº** - ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ…
âœ… **Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚** - Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸

#### Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾Ñ‚ Prodamus:
```json
{
  "_param_user": "telegram_chat_id",
  "_param_customer_id": "customerId",
  "_param_bot": "prorok",
  "payment_status": "success",
  "order_num": "12345",
  "sum": "100",
  "customer_email": "user@example.com",
  "customer_phone": "+79991234567"
}
```

#### ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ:
```javascript
{
  state: "paid_waiting_question",
  lastPaymentDate: new Date(),
  lastPaymentAmount: 100
}
```

#### Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:
```javascript
{
  amount: 100,
  bot_name: "customer_username",
  username: "telegram_chat_id",
  type: "tarot_reading",
  createdAt: Date
}
```

---

## ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº

### Webhook Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº:
1. Ð•ÑÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ customer â†’ 404 error
2. Ð•ÑÐ»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° â†’ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ÑÑ, Ð½Ð¾ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚ÑÑ
3. Ð•ÑÐ»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ â†’ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ÑÑ, Ð½Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ÑÑ
4. ÐžÐ±Ñ‰Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ â†’ 500 Ñ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼

### Webhook Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹:
1. Ð•ÑÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ user Ð¸Ð»Ð¸ customer â†’ 404 error
2. Ð•ÑÐ»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ€Ð°ÑÐºÐ»Ð°Ð´Ð° â†’ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ + 500 error
3. Ð•ÑÐ»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ â†’ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ÑÑ, Ð½Ð¾ Ñ€Ð°ÑÐºÐ»Ð°Ð´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ
4. ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ â†’ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ + 500 error

---

## Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

### Ð£Ñ€Ð¾Ð²Ð½Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:

**ðŸ“© Info** - Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ webhook
```
ðŸ“© Prodamus subscription webhook: {...}
```

**ðŸ“ Details** - Ð´ÐµÑ‚Ð°Ð»Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
```
ðŸ“ Subscription details: customerId=xxx, status=success, amount=990
```

**âœ… Success** - ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
```
âœ… Payment saved to database: 990 RUB
âœ… Customer subscription updated
âœ… Subscription notification sent
```

**âš ï¸ Warning** - Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ
```
âš ï¸ Payment not successful: pending
```

**âŒ Error** - Ð¾ÑˆÐ¸Ð±ÐºÐ¸
```
âŒ Error saving payment: ...
âŒ Customer not found: xxx
```

---

## Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…

### ÐšÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ Payments

```typescript
interface IPayment {
  amount: number;        // Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°
  bot_name: string;      // Ð˜Ð¼Ñ Ð±Ð¾Ñ‚Ð°/ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
  username: string;      // Username Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  type: string;          // Ð¢Ð¸Ð¿: "subscription_basic" | "subscription_pro" | "tarot_reading"
  createdAt: Date;       // Ð”Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ
}
```

### Ð¢Ð¸Ð¿Ñ‹ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹:
- `subscription_basic` - ÐŸÐ¾Ð´Ð¿Ð¸ÑÐºÐ° Basic
- `subscription_pro` - ÐŸÐ¾Ð´Ð¿Ð¸ÑÐºÐ° Pro
- `tarot_reading` - Ð Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ñ€Ð°ÑÐºÐ»Ð°Ð´ Ð¢Ð°Ñ€Ð¾

---

## Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

### Ð¢ÐµÑÑ‚ webhook Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸:
```bash
curl -X POST http://localhost:3000/api/prodamus/subscription \
  -H "Content-Type: application/json" \
  -d '{
    "customer_extra": "customer_id_here",
    "payment_status": "success",
    "subscription[id]": "2473695",
    "subscription[active_user]": "1",
    "subscription[date_next_payment]": "2025-11-04 12:00:00",
    "sum": "990",
    "order_num": "TEST123"
  }'
```

### Ð¢ÐµÑÑ‚ webhook Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°:
```bash
curl -X POST http://localhost:3000/api/prodamus/tarot \
  -H "Content-Type: application/json" \
  -d '{
    "_param_user": "telegram_chat_id",
    "_param_customer_id": "customer_id_here",
    "_param_bot": "prorok",
    "payment_status": "success",
    "order_num": "TEST456",
    "sum": "100"
  }'
```

---

## Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:
1. âœ… Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²ÑÐµÑ… Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
2. âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° Ð¿ÐµÑ€ÐµÐ´ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹
3. âœ… Graceful error handling Ð±ÐµÐ· Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ°
4. âœ… Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð°
5. âš ï¸ TODO: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ Ð¾Ñ‚ Prodamus
6. âš ï¸ TODO: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ rate limiting Ð´Ð»Ñ webhook endpoints

---

## Monitoring

### ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ:
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ…/Ð½ÐµÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹
- Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ webhook
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ€Ð°ÑÐºÐ»Ð°Ð´Ð°
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð½ÐµÐ¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹

### ÐÐ»ÐµÑ€Ñ‚Ñ‹:
- âŒ Ð‘Ð¾Ð»ÐµÐµ 3 Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ webhook
- âš ï¸ Ð’Ñ€ÐµÐ¼Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ > 5 ÑÐµÐºÑƒÐ½Ð´
- âš ï¸ ÐÐµÐ¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ > 10%

