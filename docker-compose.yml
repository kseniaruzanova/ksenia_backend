services:
  app:
    container_name: ksenia_backend_container
    build: .
    ports:
      - "7000:7000"
    env_file:
      - .env
    environment:
      - MONGO_URI=${MONGO_URI}
      - DB_NAME=${DB_NAME}
      - PORT=7000
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    volumes:
      # Сохраняем загруженные файлы между перезапусками (ВНЕ контейнера)
      - ./uploads:/app/uploads
      # Временные файлы для генерации видео (ВНЕ контейнера)
      - ./temp:/app/temp
    restart: unless-stopped
    command: >
      sh -c "
        echo '🚀 Starting Ksenia Backend...' &&
        echo '📁 Checking directories...' &&
        ls -la /app/uploads 2>/dev/null || echo 'Creating uploads...' &&
        echo '🎬 Checking FFmpeg...' &&
        ffmpeg -version | head -n 1 &&
        echo '✅ Starting application...' &&
        npm start
      "